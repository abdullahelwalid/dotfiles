#!/usr/bin/env bash

# $Id: install 1770 2009-10-08 20:24:10Z mjs $

# Symlinks files stored in $HOME/.config (i.e. in a subversion repository)
# to their correct location--mostly $HOME, but a few other directories
# as well, like $HOME/.subversion/config.

for f in gls ls ; do
  if [ -x "$(which $f)" ]; then
     LS=$f
     break
  fi
done

cd "$HOME/.config/home"

for f in `$LS -AB` ; do

  if [ "$f" = "CVS" ]; then
    continue
  fi

  if [ "$f" = ".svn" ]; then
    continue
  fi

  if [ ! -h "$HOME/$f" ]; then
    echo rm -f "$HOME/$f"
    rm -f "$HOME/$f"
  fi

  if [ ! -f "$HOME/$f" ]; then
    echo ln -s ".config/home/$f" "$HOME"
    ln -s ".config/home/$f" "$HOME"
  fi

done  

if [ ! -h "$HOME/.subversion/config" ]; then

  rm -f "$HOME/.subversion/config"
  echo rm -f "$HOME/.subversion/config"

  mkdir -p "$HOME/.subversion"
  ln -s "$HOME/.config/etc/subversion/config" "$HOME/.subversion/config"
  echo ln -s "$HOME/.config/etc/subversion/config" "$HOME/.subversion/config"
  
fi

#if [ "$PLATFORM" = "darwin" ]; then

	# CPAN looks for CPAN::MyConfig in ~/Library/Application Support/.cpan
	# on OS X...
	
	# See CPAN::HandleConfig::home() and CPAN::HandleConfig::require_myconfig_or_config.

#	if [ ! -h "$HOME/Library/Application Support/.cpan/CPAN/MyConfig.pm" ]; then
		
#	  rm -f "$HOME/Library/Application Support/.cpan/CPAN/MyConfig.pm"
#	  echo rm -f "$HOME/Library/Application Support/.cpan/CPAN/MyConfig.pm"

#	  mkdir -p "$HOME/Library/Application Support/.cpan/CPAN"
#	  ln -s "$HOME/.config/etc/CPAN/MyConfig.pm" "$HOME/Library/Application Support/.cpan/CPAN/MyConfig.pm"
#	  echo ln -s "$HOME/.config/etc/CPAN/MyConfig.pm" "$HOME/Library/Application Support/.cpan/CPAN/MyConfig.pm"
 
#	fi
	
#else	

	if [ ! -h "$HOME/.cpan/CPAN/MyConfig.pm" ]; then

	  rm -f "$HOME/.cpan/CPAN/MyConfig.pm"
	  echo rm -f "$HOME/.cpan/CPAN/MyConfig.pm"

	  mkdir -p "$HOME/.cpan/CPAN"
	  ln -s "$HOME/.config/etc/CPAN/MyConfig.pm" "$HOME/.cpan/CPAN/MyConfig.pm"
	  echo ln -s "$HOME/.config/etc/CPAN/MyConfig.pm" "$HOME/.cpan/CPAN/MyConfig.pm"
  
	fi
	
#fi

echo "done"

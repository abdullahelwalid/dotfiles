#!/usr/bin/env bash

# Geotags image files in input directory using GPX tracks uploaded to
# iCloud by https://itunes.apple.com/gb/app/geotag-photos-pro-2/id1008694552?mt=8

EXIFTOOL=exiftool
GPXDIR="$HOME/Library/Mobile Documents/iCloud~com~tappytaps~geotagphotos2/Documents"

if [ $# -eq 0 ]; then
  echo "usage: $(basename $0) dir"
  exit 1
fi  

if ! which -s "$EXIFTOOL" ; then
  echo "error: [$EXIFTOOL] not found"
  exit 1
fi

if ! test -d "$GPXDIR" ; then
  echo "error: [$GPXDIR] not found"
fi

if ! test -d "$1" ; then
  echo "error: [$1] is not a directory"
  exit 1
fi

exiftool -overwrite_original -geotag "$GPXDIR/*.gpx" "$1"

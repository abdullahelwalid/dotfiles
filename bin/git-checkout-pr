#!/usr/bin/env bash

if [ $# -ne 1 ]; then
  echo "usage: $(basename $0) https://github.com/.../.../pull/..."
  exit
fi

COMMAND='s|^https://github\.com/[[:alpha:]]+/[[:alpha:]]+/pull/[[:digit:]]+$||'

if [ -n "$(echo -n "$1" | sed -E -e "$COMMAND" | tr -d '\n')" ]; then
  echo "usage: $(basename $0) https://github.com/.../.../pull/..."
  exit
fi

COMMAND='s|^https://github\.com/([[:alpha:]]+)/[[:alpha:]]+/pull/[[:digit:]]+$|\1|'
USER=$(echo -n "$1" | sed -E -e "$COMMAND" | tr -d '\n')

COMMAND='s|^https://github\.com/[[:alpha:]]+/([[:alpha:]]+)/pull/[[:digit:]]+$|\1|'
REPO=$(echo -n "$1" | sed -E -e "$COMMAND" | tr -d '\n')

COMMAND='s|^https://github\.com/[[:alpha:]]+/[[:alpha:]]+/pull/([[:digit:]]+)$|\1|'
ID=$(echo -n "$1" | sed -E -e "$COMMAND" | tr -d '\n')

git fetch https://github.com/$USER/$REPO.git pull/$ID/head && git -c advice.detachedHead=false checkout FETCH_HEAD
